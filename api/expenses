let expenses = [];

export default function handler(req, res) {
  res.setHeader("Content-Type", "application/json");

  if (req.method === "GET") {
    return res.status(200).json({
      success: true,
      data: expenses
    });
  }

  if (req.method === "POST") {
    // Vercel auto-parses JSON bodies in Node runtime
    const { amount, description, category, date } = req.body || {};

    if (
      amount === undefined ||
      !description ||
      !category ||
      !date
    ) {
      return res.status(400).json({
        success: false,
        error: "Missing required fields: amount, description, category, date"
      });
    }

    const newExpense = {
      id: expenses.length + 1,
      amount: Number(amount),
      description,
      category,
      date
    };

    expenses.push(newExpense);

    return res.status(201).json({
      success: true,
      data: newExpense
    });
  }

  res.setHeader("Allow", "GET, POST");
  return res.status(405).json({
    success: false,
    error: "Method not allowed"
  });
}
